//
//
//  Generated by StarUML(tm) Java Add-In
//
//  @ Project : P-TMM-08004
//  @ File Name : MensajeDoctoBO.java
//  @ Date : 09/09/2008
//  @ Author : PROMERO
//
//

package com.tmmas.scl.framework.customerdomainfacturacion.CustomerBillABE.bo;

import com.tmmas.cl.framework20.util.UtilProperty;
import com.tmmas.scl.framework.CustomerDomain.exception.RateUsageRecordsException;
import com.tmmas.scl.framework.customerdomainfacturacion.CustomerBillABE.bo.Interface.MensajeDoctoBOIT;
import com.tmmas.scl.framework.CustomerDomain.CustomerBillABE.dto.MensajeDoctoDTO;
import com.tmmas.scl.framework.customerdomainfacturacion.CustomerBillABE.dao.MensajeDoctoDAO;
import com.tmmas.scl.framework.customerdomainfacturacion.CustomerBillABE.dao.Interface.MensajeDoctoDAOIT;

import org.apache.commons.configuration.CompositeConfiguration;
import org.apache.log4j.Logger;

public class MensajeDoctoBO implements MensajeDoctoBOIT {

	private static Logger logger = Logger.getLogger(MensajeDoctoBO.class);


	private CompositeConfiguration config;

	public MensajeDoctoBO() {
		super();
		config = UtilProperty
				.getConfiguration("ServicioFacturacionWS.properties",
						"com/tmmas/scl/framework/properties/archivorecursos.properties");
	}
	public boolean registrarMensaje(MensajeDoctoDTO mensajeDoctoDTO)
			throws RateUsageRecordsException {
		logger.debug("registrarMensaje():start");
		boolean bResultado = false;
		String sBloque = "3";
		String sFormulario = "1";
		int iCantLineasMen;
		int iCantCaractLin;
		String sMensaje;

		MensajeDoctoDAOIT mensajeDAO = new MensajeDoctoDAO();

		mensajeDoctoDTO.setCodBloque(sBloque);
		mensajeDoctoDTO.setCodFormulario(sFormulario);

		if (mensajeDAO.bObtieneParMensaje(mensajeDoctoDTO) == true) {
			iCantCaractLin = mensajeDoctoDTO.getCantCaractLin();
			iCantLineasMen = mensajeDoctoDTO.getCantLineasMen();
		} else
			return false;

		if (mensajeDoctoDTO.getModalidadCobro() == config.getString("modalidadCobroregalo")) {

			// mensajeDoctoDTO.setNumProceso(numProceso) PARAMETRO
			mensajeDoctoDTO.setCodFormulario("1");
			mensajeDoctoDTO.setCodBloque("1");
			mensajeDoctoDTO.setCorrMensaje("1");
			mensajeDoctoDTO.setNumLineas(1);
			mensajeDoctoDTO.setCodOrigen("FA");
			mensajeDoctoDTO.setDescMensaje("TIMBRE : SIN COSTO A CLIENTE");
			mensajeDoctoDTO.setIndFacturado("I");
			// mensajeDoctoDTO.setNomUsuario(nomUsuario) PARAMETRO
			// mensajeDoctoDTO.setFechIngreso(fechIngreso) PARAMETRO

			if (mensajeDAO.registrarMensajeViejo(mensajeDoctoDTO) == true)
				bResultado = true;
			else
				bResultado = false;

			return bResultado;
		}

		if (mensajeDoctoDTO.getCorrMensaje() == null) {
			if (mensajeDAO.bObtieneCorrelativoMensaje(mensajeDoctoDTO) == false)
				return false;

			// mensajeDoctoDTO.setCorrMensaje(corrMensaje) POR PARAMETRO
			// mensajeDoctoDTO.setCodIdioma() POR PARAMETRO
			// mensajeDoctoDTO.setCodIdioma(codIdioma) POR PARAMETRO

			mensajeDoctoDTO.setCodBloque(sBloque);
			mensajeDoctoDTO.setCodFormulario(sFormulario);
			mensajeDoctoDTO.setDescMensaje("MSJEFMWEB");

			sMensaje = mensajeDoctoDTO.getDescMensTotal();

			int i = 0;
			String sOracion = "";
			int iCont = 0;

			for (i = 0; i < iCantLineasMen; i++) {

				if (sMensaje.length() > iCantCaractLin) {
					sOracion = sMensaje
							.substring(iCont, iCantCaractLin + iCont);
				} else {
					sOracion = sMensaje;
					mensajeDoctoDTO.setDescMensLin(sOracion);
					mensajeDoctoDTO.setNumLinea(i + 1);
					if (mensajeDAO.registrarMensaje(mensajeDoctoDTO) == false)
						return false;
					break;
				}
				mensajeDoctoDTO.setDescMensLin(sOracion);
				mensajeDoctoDTO.setNumLinea(i + 1);

				if (mensajeDAO.registrarMensaje(mensajeDoctoDTO) == false)
					return false;

				iCont += iCantCaractLin;

			}

			// mensajeDoctoDTO.setNumProceso(numProceso) PARAMETRO
			// mensajeDoctoDTO.setCodFormulario(sFormulario);
			// mensajeDoctoDTO.setCodBloque(sBloque);
			// mensajeDoctoDTO.setDescMensaje(descMensaje)
			// mensajeDoctoDTO.setNomUsuario(nomUsuario) POR PARAMETRO
			// mensajeDoctoDTO.setFechIngreso(fechIngreso) POR PARAMETRO

			mensajeDoctoDTO.setNumLineas(iCantLineasMen);
			mensajeDoctoDTO.setCodOrigen("FA");
			mensajeDoctoDTO.setIndFacturado("I");

			if (mensajeDAO.registrarMensajeViejo(mensajeDoctoDTO) == false)
				return false;

		} else {

			if (mensajeDAO.validarMensaje(mensajeDoctoDTO) == false)
				return false;

			// mensajeDoctoDTO.setNumProceso(numProceso) PARAMETRO
			// mensajeDoctoDTO.setCodFormulario(sFormulario);
			// mensajeDoctoDTO.setCodBloque(sBloque);
			mensajeDoctoDTO.setNumLineas(iCantLineasMen);
			mensajeDoctoDTO.setCodOrigen("FA");
			// mensajeDoctoDTO.setDescMensaje(descMensaje)
			mensajeDoctoDTO.setIndFacturado("I");
			// mensajeDoctoDTO.setNomUsuario(nomUsuario) POR PARAMETRO
			// mensajeDoctoDTO.setFechIngreso(fechIngreso) POR PARAMETRO

			if (mensajeDAO.registrarMensajeViejo(mensajeDoctoDTO) == false)
				return false;
		}
		logger.debug("registrarMensaje():end");
		return true;

	}

	public boolean obtenerMensajeExistente(MensajeDoctoDTO mensajeDoctoDTO)
			throws RateUsageRecordsException {
		return false;

	}

	public boolean validarMensaje(MensajeDoctoDTO mensajeDoctoDTO)
			throws RateUsageRecordsException {
		logger.debug("validarMensaje():end");
		boolean bRetorno;

		MensajeDoctoDAOIT mensajeDAO = new MensajeDoctoDAO();

		bRetorno = false;

		if (mensajeDoctoDTO.getCorrMensaje() != null)
			if (mensajeDAO.validarMensaje(mensajeDoctoDTO) == true)
				bRetorno = true;
		logger.debug("validarMensaje():end");
		return bRetorno;
	}
}
