CREATE OR REPLACE PROCEDURE PV_VAL_HOMEPLAZA_PR (
          v_param_entrada IN  VARCHAR2,
          bRESULTADO      OUT VARCHAR2,
          vMENSAJE        OUT GA_TRANSACABO.DES_CADENA%TYPE
) IS

    string siscel.GE_TABTYPE_VCH2ARRAY:= siscel.GE_TABTYPE_VCH2ARRAY('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','');

---- parametros reales de entrada --------------

     nABONADO    	   GA_ABOCEL.NUM_ABONADO%TYPE;
     nCLIENTE		   GA_ABOCEL.COD_CLIENTE%TYPE;

	 sREGION		   GA_ABOCEL.COD_REGION%TYPE;
	 sPROVINCIA		   GA_ABOCEL.COD_PROVINCIA%TYPE;
	 sCIUDAD		   GA_ABOCEL.COD_CIUDAD%TYPE;

	 sMENSAJERR		   VARCHAR2(200);

BEGIN

	bRESULTADO := 'TRUE';
	vMENSAJE   := '';

	siscel.Ge_Pac_Arreglopr.GE_PR_RetornaArreglo(v_param_entrada, string);

    nABONADO 		:= TO_NUMBER(string(5));
	nCLIENTE   		:= TO_NUMBER(string(6));

	BEGIN

		SELECT COD_REGION,COD_PROVINCIA,COD_CIUDAD
		INTO   sREGION,sPROVINCIA,sCIUDAD
		FROM   GA_ABOCEL
		WHERE  NUM_ABONADO = nABONADO
		UNION
		SELECT COD_REGION,COD_PROVINCIA,COD_CIUDAD
		FROM   GA_ABOAMIST
		WHERE  NUM_ABONADO = nABONADO;

	EXCEPTION
	WHEN NO_DATA_FOUND THEN
		bRESULTADO := 'FALSE';
		vMENSAJE   := 'ERROR EN PV_VAL_HOMEPLAZA_PR: NO EXISTE INFORMACION DEL ABONADO.';
	END;

	BEGIN
		SELECT FN_VERIFICA_HOMEPLAZA(nCLIENTE,sREGION,sPROVINCIA,sCIUDAD)
		INTO sMENSAJERR
		FROM DUAL;
	EXCEPTION
	WHEN OTHERS THEN
		bRESULTADO := 'FALSE';
		vMENSAJE   := 'ERROR EN PV_VAL_HOMEPLAZA_PR: EN FUNCION FN_VERIFICA_HOMEPLAZA.';
	END;

	IF sMENSAJERR IS NOT NULL THEN
		bRESULTADO := 'FALSE';
		vMENSAJE   := sMENSAJERR;
	END IF;

EXCEPTION

    WHEN OTHERS THEN

		bRESULTADO := 'FALSE';
		vMENSAJE   := 'ERROR EN PV_VAL_HOMEPLAZA_PR: NO SE PUEDE VALIDAR PLAZA.';
END;
/
SHOW ERRORS
