CREATE OR REPLACE PACKAGE BODY        IC_PROCED IS
  --
  -- Retrofitted
  PROCEDURE P_IC_RESPUESTA(
  V_PRODUCTO IN GE_PRODUCTOS.COD_PRODUCTO%TYPE ,
  V_REG_BMOV IN ICB_MOVIMIENTO%ROWTYPE ,
  V_REG_CMOV IN ICC_MOVIMIENTO%ROWTYPE ,
  V_REG_MMOV IN ICM_MOVIMIENTO%ROWTYPE ,
  V_REG_RMOV IN ICR_MOVIMIENTO%ROWTYPE )
  IS
    V_COD_CELULAR GE_PRODUCTOS.COD_PRODUCTO%TYPE;
    V_COD_BEEPER  GE_PRODUCTOS.COD_PRODUCTO%TYPE;
    V_COD_TREK    GE_PRODUCTOS.COD_PRODUCTO%TYPE;
    V_COD_TRUNK   GE_PRODUCTOS.COD_PRODUCTO%TYPE;
  BEGIN
    SELECT PROD_BEEPER,PROD_CELULAR,PROD_TREK,PROD_TRUNK
      INTO V_COD_BEEPER,V_COD_CELULAR,V_COD_TREK,V_COD_TRUNK
      FROM GE_DATOSGENER;
    IF     V_PRODUCTO = V_COD_BEEPER  THEN
       P_IC_RESBEP(V_PRODUCTO,V_REG_BMOV);
    ELSIF  V_PRODUCTO = V_COD_CELULAR THEN
       P_IC_RESCEL(V_PRODUCTO,V_REG_CMOV);
    ELSIF  V_PRODUCTO = V_COD_TREK    THEN
       P_IC_RESTRE(V_PRODUCTO,V_REG_MMOV);
    ELSIF  V_PRODUCTO = V_COD_TRUNK   THEN
       P_IC_RESTRU(V_PRODUCTO,V_REG_RMOV);
    ELSE
       RAISE_APPLICATION_ERROR(-20800,'Producto no contemplado en el Interfaz');
    END IF;
  END P_IC_RESPUESTA;
  --
  -- Retrofitted
  PROCEDURE P_IC_RESBEP(
  V_PRODUCTO IN GE_PRODUCTOS.COD_PRODUCTO%TYPE ,
  V_REG_BMOV IN ICB_MOVIMIENTO%ROWTYPE )
  IS
  V_SERVNIVEL VARCHAR2(6);
  V_SERVSUPL CHAR(2);
  V_NIVEL CHAR(2);
  V_POS NUMBER(3) := 1;
  BEGIN
    IF V_REG_BMOV.COD_ACTABO = 'CE' OR V_REG_BMOV.COD_ACTABO = 'ER' THEN
       -- Borrar las losas para los servicios que vengan a nivel 0
       LOOP
          V_SERVNIVEL := SUBSTR (V_REG_BMOV.COD_SERVICIOS, V_POS, 6);
          EXIT WHEN V_SERVNIVEL IS NULL;
          V_POS := V_POS + 6;
          V_SERVSUPL := SUBSTR(V_SERVNIVEL,1,2);
          V_NIVEL    := SUBSTR(V_SERVNIVEL,3,4);
          IF V_NIVEL = '0000' THEN
              DELETE FROM ICB_PENALIZACION
               WHERE NUM_ABONADO  = V_REG_BMOV.NUM_ABONADO
                 AND COD_SERVICIO = TO_NUMBER(V_SERVSUPL);
          END IF;
       END LOOP;
    END IF;
  END P_IC_RESBEP;
  --
  -- Retrofitted
  PROCEDURE P_IC_RESCEL(
  V_PRODUCTO IN GE_PRODUCTOS.COD_PRODUCTO%TYPE ,
  V_REG_CMOV IN ICC_MOVIMIENTO%ROWTYPE )
  IS
  V_SERVNIVEL VARCHAR2(6);
  V_SERVSUPL CHAR(2);
  V_NIVEL CHAR(2);
  V_POS NUMBER(3) := 1;
  BEGIN
    IF V_REG_CMOV.COD_ACTABO = 'CE' OR V_REG_CMOV.COD_ACTABO = 'ER' THEN
       -- Borrar las losas para los servicios que vengan a nivel 0
       LOOP
          V_SERVNIVEL := SUBSTR (V_REG_CMOV.COD_SERVICIOS, V_POS, 6);
          EXIT WHEN V_SERVNIVEL IS NULL;
          V_POS := V_POS + 6;
          V_SERVSUPL := SUBSTR(V_SERVNIVEL,1,2);
          V_NIVEL    := SUBSTR(V_SERVNIVEL,3,4);
          IF V_NIVEL = '0000' THEN
              DELETE FROM ICC_PENALIZACION
               WHERE NUM_ABONADO  = V_REG_CMOV.NUM_ABONADO
                 AND COD_SERVICIO = TO_NUMBER(V_SERVSUPL);
          END IF;
       END LOOP;
    END IF;
  END P_IC_RESCEL;
  --
  -- Retrofitted
  PROCEDURE P_IC_RESTRE(
  V_PRODUCTO IN GE_PRODUCTOS.COD_PRODUCTO%TYPE ,
  V_REG_MMOV IN ICM_MOVIMIENTO%ROWTYPE )
  IS
  V_SERVNIVEL VARCHAR2(6);
  V_SERVSUPL CHAR(2);
  V_NIVEL CHAR(2);
  V_POS NUMBER(3) := 1;
  BEGIN
    IF V_REG_MMOV.COD_ACTABO = 'CE' OR V_REG_MMOV.COD_ACTABO = 'ER' THEN
       -- Borrar las losas para los servicios que vengan a nivel 0
       LOOP
          V_SERVNIVEL := SUBSTR (V_REG_MMOV.COD_SERVICIOS, V_POS, 6);
          EXIT WHEN V_SERVNIVEL IS NULL;
          V_POS := V_POS + 6;
          V_SERVSUPL := SUBSTR(V_SERVNIVEL,1,2);
          V_NIVEL    := SUBSTR(V_SERVNIVEL,3,4);
          IF V_NIVEL = '0000' THEN
              DELETE FROM ICM_PENALIZACION
               WHERE NUM_ABONADO  = V_REG_MMOV.NUM_ABONADO
                 AND COD_SERVICIO = TO_NUMBER(V_SERVSUPL);
          END IF;
       END LOOP;
    END IF;
  END P_IC_RESTRE;
  --
  -- Retrofitted
  PROCEDURE P_IC_RESTRU(
  V_PRODUCTO IN GE_PRODUCTOS.COD_PRODUCTO%TYPE ,
  V_REG_RMOV IN ICR_MOVIMIENTO%ROWTYPE )
  IS
  V_SERVNIVEL VARCHAR2(6);
  V_SERVSUPL CHAR(2);
  V_NIVEL CHAR(2);
  V_POS NUMBER(3) := 1;
  BEGIN
    IF V_REG_RMOV.COD_ACTABO = 'CE' OR V_REG_RMOV.COD_ACTABO = 'ER' THEN
       -- Borrar las losas para los servicios que vengan a nivel 0
       LOOP
          V_SERVNIVEL := SUBSTR (V_REG_RMOV.COD_SERVICIOS, V_POS, 6);
          EXIT WHEN V_SERVNIVEL IS NULL;
          V_POS := V_POS + 6;
          V_SERVSUPL := SUBSTR(V_SERVNIVEL,1,2);
          V_NIVEL    := SUBSTR(V_SERVNIVEL,3,4);
          IF V_NIVEL = '0000' THEN
              DELETE FROM ICR_PENALIZACION
               WHERE NUM_ABONADO  = V_REG_RMOV.NUM_ABONADO
                 AND COD_SERVICIO = TO_NUMBER(V_SERVSUPL);
          END IF;
       END LOOP;
    END IF;
  END P_IC_RESTRU;
END IC_PROCED;
/
SHOW ERRORS
