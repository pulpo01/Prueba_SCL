CREATE OR REPLACE PROCEDURE PV_VAL_CICLOFACTABO (
          v_param_entrada IN  VARCHAR2,
          bRESULTADO      OUT VARCHAR2,
          vMENSAJE        OUT GA_TRANSACABO.DES_CADENA%TYPE
) IS

     string GE_TABTYPE_VCH2ARRAY:= GE_TABTYPE_VCH2ARRAY('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','');

---- parametros reales de entrada --------------

	 nCLIENTE    GA_ABOCEL.COD_CLIENTE%TYPE;
	 VCLIENTE    GA_ABOAMIST.COD_CLIENTE%TYPE;

	 vCANT		 INTEGER;


BEGIN

     GE_PAC_ArregloPR.GE_PR_RetornaArreglo(v_param_entrada, string);
	 nCLIENTE 		:= TO_NUMBER(string(6));

     bRESULTADO := 'TRUE';

	 SELECT COUNT(*)
	 INTO   vCANT
	 FROM (SELECT A.COD_CLIENTE, A.NUM_ABONADO, A.COD_CICLO, B.COD_CICLFACT
	 	   FROM	(SELECT COD_CLIENTE, NUM_ABONADO, COD_CICLO, COD_SITUACION
 			 	 FROM GA_ABOCEL
			 	 WHERE COD_CLIENTE = nCLIENTE ) A,
	  	         FA_CICLFACT B
	  	   WHERE A.COD_CICLO = B.COD_CICLO
		   AND   SYSDATE BETWEEN B.FEC_DESDEOCARGOS AND B.FEC_HASTAOCARGOS ) C,
 		   GA_INFACCEL D
     WHERE C.COD_CLIENTE = nCLIENTE
	 AND   C.COD_CLIENTE = D.COD_CLIENTE
	 AND   C.NUM_ABONADO = D.NUM_ABONADO
	 AND   C.COD_CICLFACT = D.COD_CICLFACT
	 AND   D.IND_FACTUR = 1;

     IF vCANT = 0 THEN

	 	/* OCB-INI [2003-04-29] */
	    DBMS_OUTPUT.PUT_LINE('CLIENTE : ' || NCLIENTE);
		SELECT COUNT(*)
		INTO vCANT
		FROM GA_ABOAMIST
		WHERE
		COD_CLIENTE  =   NCLIENTE;


		IF vCANT = 0 THEN
  		   	   bRESULTADO := 'FALSE';
 			   vMENSAJE   := 'CLIENTE SIN ABONADOS CON CICLO DE FACTURACION VIGENTE.';

		END IF;
		/* OCB-FIN [2003-04-29] */

     END IF;

EXCEPTION
     WHEN OTHERS THEN
          bRESULTADO := 'FALSE';
		  vMENSAJE   := 'ERROR EN PV_VAL_CICLOFACTABO: NO SE PUEDE VALIDAR CICLO DE FACT. PARA ABONADOS DEL CLIENTE.';

END;
/
SHOW ERRORS
